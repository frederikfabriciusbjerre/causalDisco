% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tfci_run.R
\name{tpag}
\alias{tpag}
\title{Orient a PAG from a skeleton using temporal knowledge}
\usage{
tpag(skel, knowledge, unfVect, cautious = TRUE)
}
\arguments{
\item{skel}{A skeleton-like object as returned by \code{\link[pcalg]{pdsep}},
containing \code{$G} (adjacency), \code{$sepset}, \code{$pMax}, and
\code{$max.ord}.}

\item{knowledge}{A \emph{knowledge} object that provides tier labels for variables.}

\item{unfVect}{Optional vector of unfaithful triples from conservative/majority-rule
orientation (see \pkg{pcalg}); may be \code{NULL}.}

\item{cautious}{Logical; if \code{TRUE}, remove any separating set that violates
temporal constraints before orientation.}
}
\value{
A PAG adjacency matrix in pcalg format (integer codes \code{0/1/2/3}).
}
\description{
Apply temporal restrictions and standard FCI orientation rules to produce a PAG.
Cross-tier edges receive an arrowhead at the later node and separating sets that
condition on the future are dropped (if \code{cautious = TRUE}) before calling
\code{\link[pcalg]{udag2pag}}.
}
\examples{
### tpdag() example ###

# Full pipeline to a PAG using temporal rules
set.seed(3)
n <- 200
X1 <- rnorm(n)
X2 <- X1 + rnorm(n)
X3 <- X1 + rnorm(n)
X4 <- X3 + rnorm(n)

d <- data.frame(
  p1_X1 = X1,
  p1_X2 = X2,
  p2_X3 = X3,
  p2_X4 = X4
)
vnames <- names(d)

kn <- knowledge(
  d,
  tier(
    p1 ~ tidyselect::starts_with("p1_"),
    p2 ~ tidyselect::starts_with("p2_")
  )
)

ss_cor <- causalDisco:::make_suff_stat(d, type = "corTest")
wrapped <- causalDisco:::dirTest(causalDisco::corTest, vnames, kn)
cons <- causalDisco:::.pcalg_constraints_from_knowledge(kn, labels = vnames, directed_as_undirected = TRUE)

skel <- pcalg::skeleton(
  suffStat   = ss_cor,
  indepTest  = wrapped,
  alpha      = 0.05,
  labels     = vnames,
  method     = "stable.fast",
  fixedGaps  = cons$fixedGaps,
  fixedEdges = cons$fixedEdges
)

fci_skel <- pcalg::pdsep(
  skel = skel,
  suffStat = ss_cor,
  indepTest = wrapped,
  p = length(vnames),
  sepset = skel@sepset,
  pMax = skel@pMax,
  unfVect = c(),
  alpha = 0.05
)

# Orient to a PAG (matrix with codes 0/1/2/3)
pag <- causalDisco:::tpag(fci_skel, knowledge = kn, unfVect = NULL, cautious = TRUE)
pag
}
\keyword{internal}
