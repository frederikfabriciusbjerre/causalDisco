% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tfci_run.R
\name{order_restrict_sepset}
\alias{order_restrict_sepset}
\title{Remove illegal separating sets under temporal knowledge}
\usage{
order_restrict_sepset(sepset, knowledge, vnames)
}
\arguments{
\item{sepset}{A nested list of separating sets, typically \code{skel@sepset}
from \pkg{pcalg}, where \code{sepset[[i]][[j]]} is a vector of node indices
that separate node \code{i} and node \code{j}, or \code{NULL}.}

\item{knowledge}{A \emph{knowledge} object that provides tier labels for variables.}

\item{vnames}{Character vector of variable names, used to translate indices in
\code{sepset} into names for tier comparison.}
}
\value{
The input \code{sepset} with any disallowed separating sets replaced by
\code{NULL}. Emits a warning each time such a set is removed.
}
\description{
Given a \code{sepset} structure (as used by \pkg{pcalg}) and temporal background
knowledge, drop any separating set that conditions on a variable strictly after
both endpoints.
}
\examples{
### order_restrict_sepset() example ###

set.seed(2)
n <- 200
X1 <- rnorm(n)
X2 <- X1 + rnorm(n)
X3 <- X1 + rnorm(n)
X4 <- X3 + rnorm(n)

d <- data.frame(
  p1_X1 = X1,
  p1_X2 = X2,
  p2_X3 = X3,
  p2_X4 = X4
)
vnames <- names(d)

kn <- knowledge(
  d,
  tier(
    p1 ~ tidyselect::starts_with("p1_"),
    p2 ~ tidyselect::starts_with("p2_")
  )
)

ss_cor <- causalDisco:::make_suff_stat(d, type = "corTest")
wrapped <- causalDisco:::dirTest(causalDisco::corTest, vnames, kn)
cons <- causalDisco:::.pcalg_constraints_from_knowledge(
  kn,
  labels = vnames,
  directed_as_undirected = TRUE
)

skel <- pcalg::skeleton(
  suffStat   = ss_cor,
  indepTest  = wrapped,
  alpha      = 0.05,
  labels     = vnames,
  method     = "stable.fast",
  fixedGaps  = cons$fixedGaps,
  fixedEdges = cons$fixedEdges
)

fci_skel <- pcalg::pdsep(
  skel = skel,
  suffStat = ss_cor,
  indepTest = wrapped,
  p = length(vnames),
  sepset = skel@sepset,
  pMax = skel@pMax,
  unfVect = c(),
  alpha = 0.05
)

# Remove separating sets that condition on variables strictly in the future
sepset_clean <- causalDisco:::order_restrict_sepset(
  fci_skel$sepset,
  knowledge = kn,
  vnames = vnames
)
str(sepset_clean, max.level = 1)
}
\keyword{internal}
